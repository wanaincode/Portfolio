<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Wang, Meng-Chi | Project</title>
  <style>
    /* ===== Base ===== */
    *, *::before, *::after { box-sizing: border-box; }
    html, body { overflow-x: hidden; }
    body {
      font-family: Arial, Helvetica, sans-serif;
      margin: 0; padding: 0; line-height: 1.6;
      background: #000; color: #fff; min-height: 100vh;
    }

    /* ===== Layout ===== */
    .container {                /* 唯一外層容器：你目前用百分比，我保留 */
      max-width: 75%;
      margin: 0 auto;
      padding: 2rem 1rem 3rem;
    }
    .hero-title {
      color: #52ff43; font-weight: 800;
      font-size: clamp(2.2rem, 6vw, 3.2rem);
      letter-spacing: .02em; text-transform: uppercase;
      margin: 0 0 1.25rem 0; text-align: center;
      font-family: 'Helvetica Neue', Arial, sans-serif;
    }

    /* ===== Carousel ===== */
    .viewport {                 /* 可視區，箭頭相對這個定位 */
      position: relative;
      overflow: hidden;
      width: 100%;
    }
    .track {                    /* 橫向滑動容器 */
      display: flex;
      transition: transform .4s ease;
      will-change: transform;
    }
    .card {                     /* 一頁一張，邏輯最穩 */
      flex: 0 0 100%;
      min-width: 100%;
      padding: 1.25rem 0;
    }
    .card-box {                 /* 視覺上 90% 寬 */
      width: 90%; margin: 0 auto;
      background: #111; border: 1px solid #222; border-radius: 12px;
      box-shadow: 0 10px 24px rgba(0,0,0,.35); color: #eee;
      padding: 1.4rem 1.6rem;
      min-height: 600px; 
    }
    .project-title { font-size: 1.25rem; font-weight: 800; color: #52ff43; margin: 0 0 .5rem 0; }

    /* ===== Media / Buttons / Tags ===== */
    .media { margin-top: 0.9rem; }
    .yt-16x9 { position: relative; width: 100%; padding-top: 56.25%; }
    .yt-16x9 iframe {
      position: absolute; inset: 0; width: 100%; height: 100%; border: 0; border-radius: 8px;
    }
    .btn-row { margin-top: 0.75rem; display: flex; gap: 0.5rem; flex-wrap: wrap; }
    .btn {
      display: inline-flex; align-items: center; justify-content: center;
      padding: 0.45rem 0.75rem; border-radius: 8px; text-decoration: none;
      color: #000; background: #52ff43; font-weight: 700; border: 1px solid #3ddb2f;
    }
    .btn.outline { background: transparent; color: #fff; border: 1px solid #444; }
    .btn:hover { filter: brightness(1.05); }
    .tags { margin-top: 0.6rem; display: flex; flex-wrap: wrap; gap: 0.4rem; }
    .tag {
      font-size: 0.8rem; color: #cfd2d4; border: 1px solid #2b2b2b;
      padding: 0.15rem 0.5rem; border-radius: 999px; background:#111;
    }

    /* ===== Arrows ===== */
    .arrow {
      position: absolute; top: 50%; transform: translateY(-50%);
      width: 2.5rem; height: 2.5rem; border-radius: 50%;
      background: rgba(255,255,255,.15); border: 1px solid rgba(255,255,255,.25);
      color: #fff; display: flex; align-items: center; justify-content: center;
      cursor: pointer; transition: background .2s, transform .1s;
      backdrop-filter: blur(2px); z-index: 2000; line-height: 1; padding: 0; border: none;
    }
    .arrow:hover { background: rgba(255,255,255,.3); }
    .arrow:active { transform: translateY(-50%) scale(.96); }
    .arrow svg { width: 1.2rem; height: 1.2rem; }
    .arrow.prev { left: .5rem; }
    .arrow.next { right: .5rem; }

    /* ===== Right-side circle nav（沿用） ===== */
    .circle-nav {
      position: fixed; top: 50%; right: 20px; transform: translateY(-50%);
      display: flex; flex-direction: column; gap: 1rem; z-index: 1000; opacity: .8;
    }
    .circle-link {
      width: 70px; height: 70px; border-radius: 50%;
      background: #cfc8ff; color: #000; display: flex; align-items: center; justify-content: center;
      font-weight: bold; text-decoration: none; box-shadow: 0 4px 10px rgba(0,0,0,.3);
      transition: transform .2s ease; font-size: .85rem;
    }
    .circle-link:hover { transform: scale(1.1); }

    @media (max-width: 420px) {
      .arrow { width: 2.2rem; height: 2.2rem; }
      .arrow svg { width: 1rem; height: 1rem; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="hero-title">PROJECT</h1>

    <div class="viewport" id="viewport">
      <div class="track" id="track"><!-- JS will render cards here --></div>

      <button class="arrow prev" id="prev" aria-label="前へ">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M15 18l-6-6 6-6" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      <button class="arrow next" id="next" aria-label="次へ">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M9 6l6 6-6 6" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>
  </div>

  <div class="circle-nav">
    <a href="index.html" class="circle-link">Home</a>
    <a href="resume.html" class="circle-link">Resume</a>
    <a href="research.html" class="circle-link">Research</a>
  </div>

  <!-- 先載入資料檔 -->
  <script src="projects-data.js"></script>
  <script>
    // #comment: Render projects -> init carousel
    (function () {
      const track = document.getElementById('track');
      const viewport = document.getElementById('viewport');
      const prev = document.getElementById('prev');
      const next = document.getElementById('next');

      const escapeHtml = (s) => (s ?? "").replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
      const mediaHTML = (m) => {
        if (!m || m.type === 'none') return '';
        if (m.type === 'youtube' && m.id) {
          return `
            <div class="media yt">
              <div class="yt-16x9">
                <iframe src="https://www.youtube.com/embed/${escapeHtml(m.id)}"
                        title="YouTube video"
                        frameborder="0"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                        allowfullscreen></iframe>
              </div>
            </div>`;
        }
        if (m.type === 'video' && m.src) {
          const poster = m.poster ? `poster="${escapeHtml(m.poster)}"` : '';
          return `
            <div class="media">
              <video controls ${poster} style="width:100%; border-radius:8px;">
                <source src="${escapeHtml(m.src)}" type="video/mp4">
              </video>
            </div>`;
        }
        if (m.type === 'image' && m.src) {
          const alt = escapeHtml(m.alt || '');
          return `
            <div class="media">
              <img src="${escapeHtml(m.src)}" alt="${alt}" style="width:100%; border-radius:8px; border:1px solid #222;">
            </div>`;
        }
        return '';
      };
      const tagsHTML = (tags) => {
        if (!tags || !tags.length) return '';
        return `<div class="tags">${tags.map(t => `<span class="tag">${escapeHtml(t)}</span>`).join('')}</div>`;
      };
      const linkButtons = (p) => {
        const buttons = [];
        if (p.github) buttons.push(`<a class="btn" href="${escapeHtml(p.github)}" target="_blank" rel="noopener">GitHub</a>`);
        if (p.demo) buttons.push(`<a class="btn outline" href="${escapeHtml(p.demo)}" target="_blank" rel="noopener">Demo</a>`);
        return buttons.length ? `<div class="btn-row">${buttons.join('')}</div>` : '';
      };

      // 渲染卡片
      const list = Array.isArray(window.PROJECTS) ? window.PROJECTS : [];
      track.innerHTML = list.map(p => `
        <section class="card">
          <div class="card-box">
            <div class="project-title">${escapeHtml(p.title || "")}</div>
            <p>${escapeHtml(p.desc || "")}</p>
            ${mediaHTML(p.media)}
            ${tagsHTML(p.tags)}
            ${linkButtons(p)}
          </div>
        </section>
      `).join("");

      // 輪播初始化
      const slides = track.querySelectorAll('.card');
      if (!viewport || slides.length === 0 || !prev || !next) return;

      let index = 0;
      const slideWidth = () => viewport.offsetWidth;      // 一頁寬 = viewport
      const update = () => { track.style.transform = `translateX(${-index * slideWidth()}px)`; };

      window.addEventListener('resize', update);
      prev.addEventListener('click', () => { if (index > 0) { index--; update(); } });
      next.addEventListener('click', () => { if (index < slides.length - 1) { index++; update(); } });

      update(); // 初始化
    })();
  </script>
</body>
</html>